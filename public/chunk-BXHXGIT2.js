import{a as D,b as T,e as O,h as k}from"./chunk-2Y4L3V6A.js";import{b as E,c as R,e as I,o as c}from"./chunk-C36JEYPE.js";import"./chunk-LJ5XHLMQ.js";import{$a as w,Ca as C,Ga as M,K as v,Na as p,P as b,Pa as a,Qa as r,Va as h,Wa as y,Ya as l,Za as d,ab as S,bb as _,db as x,sa as o,xa as u}from"./chunk-RX3EO7BF.js";import{h as i}from"./chunk-FK42CRUA.js";var m=class n{constructor(t){this.auth=t;this.supabase=t.getClient()}supabase;channel=null;fetchMessages(){return i(this,null,function*(){let{data:t,error:e}=yield this.supabase.from("messages").select("*").order("created_at",{ascending:!0});return e?(console.error("Error fetching messages:",e.message),[]):t})}sendMessage(t,e){return i(this,null,function*(){let{error:s}=yield this.supabase.from("messages").insert([{content:t.trim(),user_email:e}]);return s?(console.error("Error sending message;",s.message),!1):!0})}subscribeToMessages(t){return this.channel=this.supabase.channel("messages-channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{let s=e.new;t(s)}).subscribe(e=>{console.log("Realtime subscription status:",e)}),this.channel}removeSubscription(){this.channel&&(this.supabase.removeChannel(this.channel),this.channel=null)}static \u0275fac=function(e){return new(e||n)(b(c))};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})};var P=(n,t)=>({"bg-blue-700 ml-auto text-right":n,"bg-gray-700":t});function U(n,t){if(n&1&&(a(0,"div")(1,"div",7)(2,"p",8),l(3),r(),a(4,"p",9),l(5),r()()()),n&2){let e=t.$implicit,s=y();o(),p("ngClass",x(3,P,e.user_email===s.userEmail,e.user_email!==s.userEmail)),o(2),d(e.user_email),o(2),d(e.content)}}var A=class n{constructor(t,e){this.chatService=t;this.auth=e}messages=[];newMessage="";userEmail=null;channel=null;ngOnInit(){return i(this,null,function*(){yield this.initializeUser(),yield this.loadMessages(),this.subscribeToRealtimeMessages()})}ngOnDestroy(){this.chatService.removeSubscription()}initializeUser(){return i(this,null,function*(){let t=yield this.auth.getUser();this.userEmail=t?.email??null})}loadMessages(){return i(this,null,function*(){this.messages=yield this.chatService.fetchMessages()})}subscribeToRealtimeMessages(){this.channel=this.chatService.subscribeToMessages(t=>{this.messages.push(t)})}sendMessage(){return i(this,null,function*(){if(!this.newMessage.trim()||!this.userEmail)return;(yield this.chatService.sendMessage(this.newMessage,this.userEmail))&&(this.newMessage="")})}static \u0275fac=function(e){return new(e||n)(u(m),u(c))};static \u0275cmp=C({type:n,selectors:[["app-chat-room"]],decls:9,vars:2,consts:[[1,"min-h-screen","flex","flex-col","bg-gradient-to-br","from-gray-900","via-gray-800","to-black","text-white","p-4"],[1,"text-center","text-3xl","font-bold","text-cyan-400","mb-4"],[1,"flex-1","overflow-y-auto","bg-gray-800","rounded-xl","shadow-inner","p-4","space-y-4"],[4,"ngFor","ngForOf"],[1,"mt-4","flex","items-center","gap-2"],["type","text","placeholder","Escribe un mensaje...",1,"flex-1","p-3","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-cyan-400",3,"ngModelChange","keydown.enter","ngModel"],[1,"bg-cyan-500","hover:bg-cyan-600","text-white","font-bold","py-2","px-4","rounded-lg",3,"click"],[1,"rounded-lg","p-3","max-w-md",3,"ngClass"],[1,"text-sm","text-gray-300"],[1,"text-white"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"div",1),l(2," \u{1F4AC} Sala de Chat "),r(),a(3,"div",2),M(4,U,6,6,"div",3),r(),a(5,"div",4)(6,"input",5),_("ngModelChange",function(g){return S(s.newMessage,g)||(s.newMessage=g),g}),h("keydown.enter",function(){return s.sendMessage()}),r(),a(7,"button",6),h("click",function(){return s.sendMessage()}),l(8," Enviar "),r()()()),e&2&&(o(4),p("ngForOf",s.messages),o(2),w("ngModel",s.newMessage))},dependencies:[k,D,T,O,I,E,R],encapsulation:2})};export{A as ChatRoomComponent};
